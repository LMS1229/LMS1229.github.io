---
title: 금광
layout: post
author:
name: 이민석
date: 2023-12-23 23:00:00 +0900
categories: ["PS"]
tag : ["세그먼트 트리", "스위핑"]
math: true
---

[BOJ 금광](https://www.acmicpc.net/problem/10167)

## 풀이
좌표 평면 상에서 $x$ 축을 기준으로 금광의 양 끝점을 잡는다면 이를 직사각형의 $y$ 범위에 따라 넓이가 달리지게 된다.

이 때, 양 끝 점 $x_1, x_2 (x_1 < x_2)$ 에 대하여 만들 수 있는 직사각형의 최대 $y$ 좌표값을 $y_{max}$ , 최소값을 $y_{min}$ 이라 한다면 양 끝 점 $x_1, x_2$ 인 직사각형의 $y$ 는 $[y_{min}, \frac{y_{max}+y_{min}}{2}]$ 에 있거나,  $[\frac{y_{max}+y_{min}}{2} + 1, y_{max}]$ 에 존재하거나 이 둘 사이에 걸쳐있게 된다.

이는 세그먼트 트리를 이용하면 빠르게 구할 수 있다.

세그먼트 트리의 각 노드에 다음의 정보를 저장한다.
1. 현재 구간에서 왼쪽 끝을 반드시 포함하는 최댓값 ($left_{max}$)
2. 현재 구간에서 오른쪽 끝을 반드시 포함하는 최댓값 ($right_{max}$)
3. 현재 구간의 총합 ($sum$)
4. 현재 구간에서의 최댓값 ($sum_{max}$)

이를 이용하면 현재 노드에서 각 값은
1. 왼쪽 자식 노드의 $left_{max}$ 와 왼쪽 자식 노드의 $sum$ + 오른쪽 자식 노드의 $left_{max}$ 중 최댓값
2. 오른쪽 자식 노드의 $right_{max}$ 와 오른쪽 자식 노드의 $sum$ + 왼쪽 자식 노드의 $right_{max}$ 중 최댓값
3. 두 자식 노드의 $sum$ 의 핪
4. 왼쪽 자식 노드의 $sum_{max}$, 오른쪽 자식 노드의 $sum_{max}$, 왼쪽 자식 노드의 $right_{max}$ + 오른쪽 자식 노드의 $left_{max}$ 중 최댓값

이 된다. 

이를 사용하기 위해 $x$ 와 $y$ 에 대하여 좌표압축을 통해, 세그먼트 트리의 범위를 줄인다.

그리고 $y$ 에 대하여 정렬한 뒤, 모든 좌측 끝 점 $x$ 에 대하여 모든 금광을 순회하며 세그먼트 트리를 갱신하며 트리에서 최댓값을 구해낸다. 

모든 $x$ 에 대하여 세그먼트 트리의 갱신을 이루기에 총 시간 복잡도는 $O(N^2logN)$ 이 된다. 