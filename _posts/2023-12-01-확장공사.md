---
title: "[BOJ] 확장 공사"
author:
name: 이민석
date: 2023-12-01 20:28:00 +0900
categories: ["PS"]
tags: ["볼록 껍질","볼록 다각형의 내부 점 판정"]
math: true
---


[BOJ 확장 공사](https://www.acmicpc.net/problem/30790)

## 풀이

먼저 새로운 표지판이 $(x,y)$에 추가됐다 가정하자.\
표지판이 추가 되기전의 볼록 다각형을 이루는 점들의 좌표들 $S_{n} =  \\{ (x_i,y_i) | f((x_k,y_k),(x_{k+1 \, mod \, n(S_n)},y_{k+1 \, mod \, n(S_n)}),(x_{k+2 \, mod \, n(S_n)},y_{k+2 \, mod \, n(S_n)})) = 1$ $ 0\le k \lt n(S_n) \\}$ 라 한다면
>$f(p_0, p_1, p_2)=p_0 \rightarrow p_1 \rightarrow p_2$ 가 시계 방향이면 $-1$ , 반시계 방향이면 $1$ 직선이면 $0$

$(x,y)$ 로 인해 새로운 볼록 다각형 $S_{n+1}$을 만들어야 한다면 $n(S_n) \ge n(S_{n+1} - (x,y))$ 이므로 $S_{n}-S_{n+1}-(x,y) = S_n^{\prime}$ 에 대하여 다음과 같다.
$S_n^{\prime}= \\{(x_i,y_i) | f((x_k,y_k),(x_{k+1 \ mod \ n(S_n^{\prime})},y_{k+1 \ mod \ n(S_n^{\prime})}),(x_{k+2 \ mod \ n(S_n^{\prime})},y_{k+2 \ mod \ n(S_n^{\prime})})) = 1,$ $ 0\le k \lt n(S_n^{\prime}) \\}$
>$\exists (x_k,y_k) \in S_n^{\prime} ,\ (x_{i-1},y_{i-1}),(x_i,y_i),(x_{i+1},y_{i+1}) \in S_n^{\prime} \rightarrow $
>1. $ f((x,y),(x_i,y_i),(x_{i+1},y_{i+1})) = -1 \ (i \gt k) \land f((x,y),(x_i,y_i),(x_{i-1},y_{i-1})) = -1 (\ i \le k)$ 
>이거나 
>2. $ f((x,y),(x_i,y_i),(x_{i+1},y_{i+1})) = -1 \ (i \ge k) \land f((x,y),(x_i,y_i),(x_{i-1},y_{i-1})) = 1 (\ i \lt k)$
>이다.

이 때, $x_k \ge x$ 를 만족한다. \
그리고 볼록 다각형의 윗 부분 $upper$와 아랫 부분 $lower$ 로 나누어 생각하자. 만약 $upper$ 부분만 변경된다면 1번 케이스, $lower$ 부분만 변경된다면 2번 케이스가 된다.\
따라서 두 부분을 $BST$로 관리한다면 $(x,y)$ 에 대한 $(x_k,y_k)$ 를 로그 시간에 구할 수 있고 $S_n^{\prime}$ 에 존재하는 점들을 빠르게 찾을 수 있다. 

예외적인 케이스로 볼록 다각형의 양끝이 변경되는 경우에는 $upper$ 와 $lower$ 모두 탐색하여 $S_n^{\prime}$ 를 구하면 된다.

이렇게 $S_n^{\prime}$을 구한다면 새로 추가된 넓이는 $A(\{p_0,p_1,p_2\}) - A(S_n^{\prime} \cup \{p_0,p_2\})$ 로 구할 수 있고 변경된 둘레의 길이는 $R(\{p_0,p_1,p_2\}) - R(S_n^{\prime} \cup \{p_0,p_2\})$ 로 구할 수 있다. \
$(p_0,p_1,p_2)=((x_{i-1},y_{i-1}),(x_i,y_i),(x_{i+1},y_{i+1})),\ (x_{i-1},y_{i-1}), $ $(x_i,y_i),(x_{i+1},y_{i+1}) \in S_{n+1},\ (x,y)=(x_i,y_i)$
>$A(S)=S$에 존재하는 점들로 이루어진 볼록 다각형의 넓이
>$R(S)=S$에 존재하는 점들로 이루어진 볼록 다각형의 둘레

따라서 모든 표지판에 대하여 새로운 볼록 다각형을 만든다면 $(x_k,y_k)$ 를 찾는데 소요되는 총 시간은 $O(QlogQ)$ 이고 둘레와 넓이를 갱신하는데 $O(Q)$ 의 시간 복잡도를 가진다.

그리고 $(x,y)$ 가 현재 다각형의 내부이기 위해선 $lower$ 보다 위에 있으면서 $upper$ 보다 아래에 있어야 한다. 이는 각 부분에 대하여  $(x_k,y_k)$ 를 찾은 뒤, $f((x,y),(x_k,y_k),(x_{k+1},y_{k+1}))$ 의 값을 보고 판정하면 된다. ($f$ 가 $-1$ 이면 아래, $1$ 이면 위, $0$ 이면 경계선에 있는 것이다.)