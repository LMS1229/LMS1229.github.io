---
title: 스프라그-그런디 정리
layout: post
author:
name: 이민석
date: 2023-12-06 22:00:00 +0900
categories: ["CS","알고리즘"]
tag : ["게임 이론"]
math: true
---

## 개요
2명이서 베스킨라빈스 게임을 하게 되면 언제나 선공이 이기는 방법이 존재한다.\
만약 시작 숫자가 달라지면 어떻게 될까?? 이는 `스프라그-그런디 정리` 를 이용하면 해결할 수 있다.

## 게임의 조건
먼저 `스프라그-그런디 정리`는 2명이서 플레이 하는 게임에서 사용될 수 있는 이론으로 이런 게임의 조건은 다음과 같다.

1. 게임이 끝날 때까지 두 플레이어의 차례는 번갈아 진행된다.
2. 한 플레이어가 어떤 선택도 할 수 없는 경우, 승자가 정해진다.
3. 게임은 유한 시간에 종료될 수 있다. 
4. 모든 플레이는 두 플레이어가 모두 할 수 있어야 한다.
5. 두 플레이어는 게임에 대한 모든 정보를 알 수 있다.

이러한 조건을 만족하지 않는 게임으로는 체스와 바둑[^1], 100m 경주[^2], 포커[^3] 등이 있다.\
위 조건을 만족하는 대표적인 게임으로 님(Nim) 이 있다. 

이런 게임을 진행하며 두 플레이어는 어떤 행동을 통해 현재 게임 상태를 바꿀 수 있다.\
베스킨 라빈스 게임을 예시로 현재 시작 숫자가 $x$ 이면 $x \sim x-2$ 중, 하나의 숫자 $k$ 까지 외쳐, 다음 시작 숫자를 $k-1$ 로 바꿀 수 있다. 

이렇게 게임의 상태를 바꿀 수 있는 행동들의 집합을 우리는 행동 집합이라고 부른다.

## 행동 집합
베스킨 라빈스 게임에서 현재 시작 숫자를 $x$ 라 하자.\
$x=0$ 이면 어떤 행동도 할 수 없으므로 행동집합은 $\{\}$ 가 된다. 이를 $*0$ 라 하자. 

$x=1$ 이면 1개의 숫자를 불러 다음 게임에서의 행동 집합을 $\ast 0$로 만드는 행동만 할 수 있다. 이런 행동을 $\ast 0$라 하자.[^4] 그렇다면 행동 집합은 $\\{\ast 0 \\}$ 이 되고 이를 $\ast 1$ 이라 하자.


$x=2$ 이면 다음 행동 집합을 $\ast 0$ 혹은 $\ast 1$로 만드는 행동을 할 수 있기에 행동 집합은 $\\{\ast 0, \ast 1 \\}$ 이 되고 이를 $\ast 2$ 이라 하자. 


$x=3$ 이면 다음 행동 집합을 $\ast 0$ 혹은 $\ast 1$ 혹은 $\ast 2$ 로 만드는 행동을 할 수 있기에 행동 집합은 $\\{\ast 0, \ast 1, \ast 2\\}$ 이 되고 이를 $\ast 3$ 이라 하자. 

이를 일반화한다면 $x=k$ 일 때, 행동 집합은 $\\{\ast (k-3), \ast (k-2), \ast (k-1)\\}$ 이 된다. 

이 때 $\ast 0 = \{\} , \ast (n+1)=\{\ast i | 1\le i \le n\} $ 가 된다.

### 그런디 수
위에서 우리는 행동 집합을  표현할 때 $\ast n$ 형태로 표현했다. 이를 우리는 `그런디 수` 혹은 `님버`라고 부른다.  

### 한 번에 두 게임을 한다면?
맨 처음, 베스킨 라빈스 게임은 선공이 반드시 이기는 방법이 존재하니, 두 베스킨 라빈스를 동시에 진행해보자.[^5] \
현재 시작 숫자를 $(x_1, x_2)$ 라 한다면 $x_1$ 을 감소시키거나 $x_2$ 를 감소시킬 수 있다.

$x_1$ 만으로 진행하는 게임의 행동 집합을 $G$, $x_2$ 만으로 진행하는 게임의 행동 집합을 $G^{\prime}$ 이라 했을 때, 둘 중 한 집합에 속한 행동을 하게 된다. 
그렇다면 $(x_1, x_2)$ 에서의 행동 집합은 $a+G^{\prime}$ 와  $G+b$ 의 합집합으로 표현할 수 있다. ($a \in G, b \in G^{\prime}$)

$$
G+G^{\prime} = \{G+b | b \in G^{\prime} \} \cup \{a+G^{\prime} | a \in G \}
$$

## 그래서 누가 이김??
결국에 우리는 누가 이기는지 알고 싶다. 님과 같은 게임에서 내가 무조건 지는 행동집합들과 이기는 행동집합들로 나눌 수 있다. 이런 집합들을 각각 $\mathcal{P}-$행동집합, $\mathcal{N}-$행동집합 이라고 부른다. 즉 현재 게임 상태에서 행동집합이 둘 중 어느 집합에 속한지만 안다면 게임의 승패를 알 수 있게 된다. 
만약 현재 게임 상태에서의 행동 집합 $X$에 모든 행동이 $\mathcal{N}-$행동집합에 속한다면 $X$ 는 $\mathcal{P}-$행동집합 이라 볼 수 있다.\
어느 한 행동이 $\mathcal{P}-$행동집합에 속한다면 $\mathcal{N}-$행동집합에 속한다고 볼 수 있다.
그 이유는 다음과 같다.
>먼저 $X$의 모든 행동이 $\mathcal{N}-$행동집합에 속한다면 어떤 행동을 하든 무조건 게임을 지게 된다. 즉, $X$는 $\mathcal{P}-$행동집합에 속한다.
>어느 한 행동이 $\mathcal{P}-$행동집합에 속한다면 현재 차례의 플레이어는 반드시 그 행동을 골라 상대가  $\mathcal{P}-$행동집합에서 행동하도록 하기에 현재 플레이어는 반드시 이기므로  $\mathcal{N}-$행동집합에 속한다.

## 행동 집합의 동등
임의의 두 행동 집합 $A,B$에 대해서 임의의 다른 행동 집합 $H$가 있을 때, $A+H$ 와 $B+H$ 모두 $\mathcal{P}-$행동집합에 속하거나 $\mathcal{N}-$행동집합에 속한다면 우리는 이를 동등하다고 말하며 $A \approx B$ 형태로 표현한다. \
쉽게 풀이하면 두 게임 상태에서 다른 게임을 동시에 진행해도 결과가 같다면 같은 게임으로 보자는 것이다.\
이런 동등에 관하여 2가지 정리가 있다. 

### $A$ 가 $\mathcal{P}-$행동집합에 속하면 $G \approx A+G$
먼저 두 집합이 동등하기 위해 $G+H$ 와 $A+G+H$ 모두가 $\mathcal{P}-$행동집합에 속하거나 $\mathcal{N}-$행동집합에 속하는지 보면 된다.\
$G+H$ 가 $\mathcal{P}-$행동집합 속한다면 $A$ 가 $\mathcal{P}-$행동집합에 속하기 때문에 $A+G+H$ 역시 $\mathcal{P}-$행동집합에 속하게 됩니다. 

>만약 게임 $A$ 에서 어떤 행동을 취하든 게임에서 지게 됩니다.\
>이는 $G+H$에도 똑같이 적용됩니다.
{: .prompt-info}

$G+H$ 가 $\mathcal{N}-$행동집합 속한다면 $G+H$에서 어떤 상태를 고르든 해당 게임은 무조건 이길 수 있다. 그 상태에서 상대는 어느 게임을 진행할지 골라야 한다.
1. 만약 $A$ 에서 고른다면 $A$ 가 $\mathcal{P}-$행동집합에 속하므로 해당 게임은 무조건 이길 수 있다. 
2. 만약 $G+H$의 게임을 이어서 한다면 $G+H$는 $\mathcal{N}-$행동집합에 속하기에 무조건 이길 수 있다.

즉, $A+G+H$는 $\mathcal{N}-$행동집합에 속하게 된다. 

따라서 $G \approx A+G$ 는 언제나 동등함을 알 수 있다.

### $A \approx B$ 와  $A+B$가 $\mathcal{P}-$행동집합에 속함은 동치이다.
$A$ 가 $\mathcal{P}-$행동집합에 속한다고 가정하자. \
현재 차례에서 $A$에 속한 행동을 하면 상대는 그 행동에 대한 자신의 승리를 보장하는 행동을 한다. 이는 $B$ 에서의 행동을 해도 똑같다.\
따라서 $A$ 가 $\mathcal{P}-$행동집합이면 $A+B$는 $\mathcal{P}-$행동집합에 속한다.

$A$ 가 $\mathcal{N}-$행동집합에 속한다고 가정하자. \
현재 차례에서 $A$에 속한 행동을 하면 상대는 $B$에서 어느 한 행동을 할 것이다. 그렇다면 차례가 돌아왔을 때의 두 행동 집합은 모두 $\mathcal{P}-$행동집합에 속하게 되므로 무조건 지게 된다. 
따라서 $A$ 가 $\mathcal{N}-$행동집합이면 $A+B$는 $\mathcal{P}-$행동집합에 속한다.

역으로 $A+B$가 $\mathcal{P}-$행동집합에 속한다고 가정하자.\
그렇다면 $A \approx A+A+B$ 이고 $A+A$ 는 $\mathcal{P}-$행동집합이기에 $B \approx A+A+B$ 이므로 $A \approx B$이다.

## 스프라그-그런디 정리
길었던 서론을 끝으로 본론으로 들어가자. 스프라그-그런디 정리는 이런 모든 행동 집합이 어떠한 `그런디 수`와 대응된다는 것이다. 

$$
G=\{G_1, G_2,G_3,...,G_k \}, \forall i \in [1:k] G_i \approx \ast n_i \rightarrow G^{\prime}=\{ \ast n_1, \ast n_2, ... , \ast n_k \}\land G \approx G^{\prime} 
$$

또한 $G^{\prime}=\{ \ast n_1, \ast n_2, ... , \ast n_k \} \rightarrow G^{\prime}=\ast m$ 이다. 
>$m=mex(\{n_i|1 \le i \le k\})$ , $mex(S)=S$ 에 존재하지 않는 원소 중, 가장 작은 음이 아닌 정수
{: .prompt-info}

### 증명 1
$k=0$ 이면 $G=G^{\prime}=\varnothing$ 이므로 자명하다.\
$k \ne 0$ 일 때, 행동 집합 $G+G^{\prime}$에 대해서 행동 순서가 $G_i , \ast n_i$ 인 경우와 $\ast n_i, G_i$ 인 경우를 보자.\
그렇다면 행동 집합은 $G_i + \ast n_i$ 가 된다. $G_i \approx \ast n_i$ 이므로 $G_i + \ast n_i$ 는 $\mathcal{P}-$행동집합에 속한다.\
따라서 현재 어떤 행동을 하든 패배하기에 $G+G^{\prime}$ 은 $\mathcal{P}-$행동집합에 속하고 이는 $G \approx G^{\prime}$ 을 의미한다.

### 증명 2
$G^{\prime}$이 공집합이라면 자명하다. 공집합이 아니라면 행동 집합 $G^{\prime} + \ast m$ 을 보자.\
$0 \le m^{\prime} < m$ 에 대하여 $\ast m$ 에서 행동 $\ast m^{\prime}$ 를 취한다고 하자. 그렇다면 $m$ 의 조건에 의해 $m^{\prime} = n_i$ 인 $n_i$ 가 존재한다. 즉 $\ast m^{\prime} + \ast n_i = \ast m^{\prime} + \ast m^{\prime}$ 이므로 $G^{\prime} + \ast m$ 은 $\mathcal{P}-$행동집합이 된다. \
따라서 $G^{\prime} \approx \ast m$ 이다.

## 승패 판정
우리는 이 두 정리를 통해 모든 행동 집합은 하나의 그런디 수로 표현할 수 있음을 알게 됐다. 그렇다면 어떤 그런디 수가 $\mathcal{P}-$행동집합에 속하게 될까?\
행동 집합 $G \approx \ast 0$라 하자. 이 때 동등의 정의에 의해 $G + \ast 0 = \ast 0 + \ast 0$ 가 된다. $\ast 0 + \ast 0$ 는 $\mathcal{P}-$행동집합이므로 $\ast 0$ 은 $\mathcal{P}-$행동집합 이거나 $\mathcal{N}-$행동집합이다. 그러나 $\ast 0 = \{\}$ 이기에 $\mathcal{P}-$행동집합이 된다. \
만약 $\ast 0$ 아닌 그런디 수인 경우 다음 차례에 $\ast 0$ 로 만들 수 있으므로 $\mathcal{N}-$행동집합 된다. \
따라서 어떤 행동 집합 $G \approx \ast m$ 일 때, $m=0$ 이면 선공이 지고 $m \ne 0$ 이면 선공이 이긴다.

## 여러 게임에서의 그런디 수
먼저 행동 집합 $G$ 에 대하여 $G+\{\} = G$ 이므로 다음이 성립한다.

$$
\ast n + \ast 0 = \ast n
$$

그렇다면 두 행동 집합 $G \approx \ast n , \ G^{\prime} \approx \ast m$ 에 대해선 어떻게 될까?\
이는 다음과 같다.

$$
\ast n + \ast m = \ast(n\oplus m)
$$

이 때 $\oplus$ 는 $bitwise\ xor$ 연산이다.

### 증명
$m=0$일 때는 자명하다. \
$m=k$일 때 성립한다고 가정하자. $m=k+1$일 때도 성립함을 보면 된다. \
일단 $i\lt n$ 이면 $\ast i + \ast (k+1) = \ast(i\oplus (k+1))$ 이 성립한다고 하자.
편의상 $t=n\oplus (k+1)$ 이라 하겠다.

#### $0 \le s \lt t$
$u=s\oplus t$ 라 하면 $2^{x-1} \le u \lt 2^x$ 이다. 이 때, $s \lt t$ 이므로 $t$ 와 $s$ 를 2진수로 표현했을때, $t$ 와 $s$의 $x$ 번째 자리의 숫자는 각각 $1,0$ 이다.\
따라서  $n\oplus (k+1)$ 에 대해서 $n, (k+1)$ 를 2진수로 표현했을 때 둘 중 하나만 $x$ 번째 자리의 숫자가 $1$ 이다.\
이 때, $n$ 의 $x$ 번째 자리의 숫자가 $1$이라 하자. 그렇다면 $n\oplus u \lt n$ 이다. 이는 그런디 수의 정의에 의해 $\ast(n\oplus u) \in \ast n$ 이므로 다음이 성립한다.

$$
\ast(n\oplus u) + \ast (k+1) \approx \ast (n \oplus u \oplus (k+1)) \in \ast n  + \ast (k+1)
$$

이 때, $n \oplus u \oplus (k+1) = u \oplus t = s \oplus t \oplus t = s$ 이므로 조건을 만족한다. \
$k+1$ 의 $x$ 번째 자리의 숫자가 $1$ 이여도 성립한다. 

#### $s \ge t$
$\ast s \in \ast n  + \ast (k+1)$ 라 가정하자. $\ast n$ 에서 행동 하나를 골라 $\ast s$ 가 되었다고 하자.  그렇다면 $\ast s \in \{\ast a + \ast (k+1) | 0 \le a \lt n-1\} \approx \{a\oplus (k+1) | 0 \le a \lt n-1 \}$ 여야한다. 그러나 $s \ge t=n\oplus (k+1)$  이므로 모순이다. 

>만약 그런 $s_1 \ge s$가 존재해도 이는 $s_2 = s \lt t$ 에 대해서 $*s_1 \approx *s_2$이다.
{: .prompt-info} 

즉, 모든 $m$에 대해서 $\ast n + \ast m = \ast(n\oplus m)$ 이다. 

이를 $n$에 적용해도 똑같기에 모든 음이 아닌 정수 $n,m$에 대하여 $\ast n+\ast m = \ast (n \oplus m)$ 이다.\

이 때 행동 집합의 덧셈 연산은 결합법칙을 만족하기에 

$$
\sum_{i=1}^{k}{\ast n_i} = \ast (n_1 \oplus n_2 \oplus ... \oplus n_k)
$$

로 표현할 수 있다.


[^1]:두 플레이어가 움직일 수 있는 기물, 놓을 수 있는 돌이 서로 다름
[^2]:두 플레이어가 동시에 달리는 형태로 진행
[^3]:두 플레이어는 서로 상대의 패에 알 수 없는 카드가 존재
[^4]:행동집합 $*0$ 와는 기호만 같고 다른 의미이다. 
[^5]:현재 시작 숫자 형태를 $(x_1, x_2)$ 한다면 $x_1$ 을 감소시키거나 $x_2$ 를 감소시키는 방식