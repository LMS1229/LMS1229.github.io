---
title: Range GCD
layout: post
author:
name: 이민석
date: 2023-12-23 23:00:00 +0900
categories: ["PS"]
tag : ["세그먼트 트리", "스위핑"]
math: true
---

[BOJ Range GCD](https://www.acmicpc.net/problem/12858)

## 풀이
먼저 $\gcd(a,b) = \gcd(a,a-b)$ 임을 알아야 한다. \
이를 확장하게 되면 $\gcd(a,b,c,d...) = \gcd(a,a-b,b-c,...)$ 이므로 두 개의 세그먼트 트리를 이용해보자.

하나는 $\| a_{i+1} - a_i \| $ 를 저장하는 세그먼트 트리 $T_1$, 나머지 하나는 $a_i$ 를 관리하는 세그먼트 트리 $T_2$ 라고 하자.

그렇다면 $T \neq 0$ 인 쿼리에 대해선 $a_{i+1} - a_i$ 의 값은 $i=A-1$ 인 경우와 $i=B$ 인 경우만 바뀌게 되고  $T_2$ 는 구간 갱신이 필요하다.

$T = 0$ 이면 $\gcd(a_A,a_{A+1} , \dots ,a_B) = \gcd(a_A,\| a_{A+1} - a_A \| , \dots ,a_B - a_{B-1})$ 이므로 $T_2$ 에서 $a_A$ 를 구하고 $T_1$ 를 자식 노드들에 대한 $\gcd$ 를 구하는 형태로 구한다면 $T_1$ 에서 구간 $[A,B-1]$ 의 값을 구하면 된다.

따라서 최종적으로 $T_1$ 은 구간 $[x,y]$ 에 대하여 $\gcd(a_{x+1} - a_x, ... ,a_{y+1}-a_{y})$ 를 저장하는 세그먼트 트리, $T_2$ 는 구간 $[x,y]$ 에 대하여 $\sum_{i=x}^y{a_i}$ 를 관리하는 느리게 갱신하는 세그먼트 트리 형태로 한다면 각 쿼리를 다음과 같이 처리할 수 있다.

1. $T=0$
    1. $T_2$ 에서 $a_A$ 의 값을 가져온다.
    2. $T_1$ 에서 구간 $[A,B-1]$ 에 대한 갑을 가져온다.
    3. 두 수의 최대 공약수를 구한다.

1. $T \neq 0$
    1. $T_1$ 에서 구간 $[A,B]$ 에 $T$ 를 더한다. 
    2. $T_1$ 에서 구간 $a_A$ 와 $a_{A-1}$ 값을 가져온다.
    3. $T_2$ 에서 $a_A-a_{A-1}$ 에 대한 값의 갱신을 수행한다.
    4. $T_1$ 에서 구간 $a_B$ 와 $a_{B+1}$ 값을 가져온다.
    5. $T_2$ 에서 $a_{B+1}-a_{B}$ 에 대한 값의 갱신을 수행한다.