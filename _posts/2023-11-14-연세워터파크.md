---
title: "[BOJ] 연세워터파크"
author:
name: 이민석
date: 2023-11-14 19:39:00 +0900
categories: ["PS"]
tags: ["덱, 우선 순위 큐"]
math: true
---

[BOJ 연세워터파크](https://www.acmicpc.net/problem/15678)

## 풀이
저, 점수를 얻는 과정을 보면 $x$번 징검다리를 기준으로 $x$번보다 큰 번호의 징검다리를 순차적으로 밟아 가서 점수를 얻는 경우만 확인해도 된다. 즉 $a \rightarrow b \rightarrow c \space (a<c<b)$ 번 순서대로 밟는 경우는 고려하지 않아도 된다.

### 어째서?

만약 $a \rightarrow b \rightarrow c \space (a<c<b)$ 번 순서로 밟는다고 가정하자. 그렇다면 $b-a\leq D$ 이므로 $c-a<D$ 이다. 

즉, $a \rightarrow b \rightarrow c \space (a<c<b)$ 번 순서로 밟을 수 있다면 $a \rightarrow c \rightarrow b \space (a<c<b)$ 번 순서대로 밟을 수 있고 이 둘이 얻을 수 있는 점수는 동일하다. 

따라서 우리는 $f(i)=$ ( $i$번째 징검다리를 마지막으로 밟았을 때 얻을 수 있는 최대 점수 ) 에 대하여 $max_{1\leq i \leq n}(f(i))$ 를 구하면 된다. 

각 $i$번째 징검다리를 밟아서 얻을 수 있는 점수를 $s(i)$ 라고 한다면 $f(i)$ 는 다음과 같이 정의할 수 있다.

$$
f(i)=s(i) + max(0,max_{i-D\leq j \lt i}(f(j)))
$$

$max_{i-D\leq j \lt i}(f(j))$ 는 우선 순위 큐를 이용하여 쉽게 구할 수 있다. 상세 내용은 아래 상세 풀이에 적어두겠다.

### 우선 순위 큐
먼저 $i$를 $f(i)$ 가 큰 것을 우선으로 하는 우선 순위 큐 $Q$ 에 순차적으로 저장한다.  

그리고 현재 $j$ 번째 징검다리에 대하여 $f(j)$ 를 구할 때, $Q$에서 우선 순위가 가장 높은 원소를 반환하고 제거한다. 

이렇게 얻은 원소 $i$ 에 대하여 $j-i\leq D$ 이 될 때 까지 이를 반복한다. 

마지막으로 반환된 $i$에 대하여 $f(j)=s(j)+max(0,f(i))$ 이다.

마지막으로 $Q$ 에 $j$ 를 삽입한다.

좀 더 빠른 방법으로 덱을 이용하는 방법이 있다. 

### 덱
먼저 $f(j)$ 를 구하면 $f(i)<f(j)\space (i<j)$ 를 만족하는 모든 $i$ 는 $f(k)\space (k>j)$ 를 구할 때 $max_{k-D\leq i \lt k}(f(i))$ 후보 군에서 모두 제거 되도 무방하다. 

따라서  $f(i)$ 를 순자척으로 저장하며  $f(j)<f(i)\space (j<i)$ 를 만족하는 모든 $j$ 를 제거 해나간다면

저장된 값은 비 오름차순으로 정렬되어 저장된다. 

#### 증명
먼저 리스트 $A=[\infty = f(0)]$ 라 가정하자. 

우리는 위 과정을 통해 최종적으로 $A=[a_0 = f(0),a_1,a_2,...,a_k]$  에 대하여 모든 $0 \leq i \lt j \leq k, \space a_i\geq a_j$ 임을 증명하면 된다

>1. $n=1$ 
$A$ 에는 $\infty$ 밖에 존재하지 않으므로 그대로 $f(1)$ 을 저장하면 $A=[\infty, f(1)]$ 이 되므로 위 조건을 만족한다.
2. $n=x$ 일 때 성립하다고 가정\
$n=x$ 일 때 최종적으로 $A=[a_0 = f(0),a_1,a_2,...,a_k]$ 이다.\
이 때 $f(x+1)$ 보다 작은 $a_i$ 중, 가장 큰 값을 $a_t$ 라 한다면 $f(x+1) \gt a_t \geq a_{t+1} \geq a_{t+2} , ... , \geq a_k$ 가 된다. \
즉, $A$ 의 가장 뒤에 있는 원소부터 제거 해나가면 된다. \
따라서 위의 과정을 거치면 $A=[a_0,a_1,...a_{t-1},f(x+1)]$ 이 된다. \
$A=[a_0 = f(0),a_1,a_2,...,a_k]$ 일 때 조건을 만족하므로 $[a_0,a_1,...,a_{t-1}]$ 또한 위 조건을 만족한다. \
그리고 $a_0 \ge a_1 \ge a_2 \ge ... \ge a_{t-1} \ge f(x+1)$ 이다.\
그러므로 $n=x$ 일 때 성립한다면 $n=x+1$ 일 때 위의 과정을 거쳐도 조건을 만족한다.
> 

따라서 덱에 $i$ 값을 저장하며 $f(j)$ 를 구할 때, (덱의 맨 앞에 있는 원소) = $e$ 에 대해서 $i-e>D$ 라면 모두 제거하고 $i-e\leq D$ 라면 $f(j)=s(i) + max(0,f(e))$ 가 된다.

그 뒤, 모든 (덱의 뒤에 있는 원소) = $k$ 에 대해서 $f(k)<f(j)$ 라면 $k$를 제거한다.

그리고 $j$ 를 저장한다.

위 과정을 $j=1 \sim n$ 까지 반복하면 모든 $f$ 값을 구할 수 있다.

최종적으로 우선 순위 큐로 힙을 이용한다면 $O(NlogN)$ , 덱을 이용한다면 $O(N)$ 의 시간 복잡도를 가진다.