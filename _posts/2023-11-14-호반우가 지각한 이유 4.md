---
layout: post
title: "[BOJ] 호반우가 지각한 이유 4"
author:
name: 이민석
date: 2023-11-14 20:02:00 +0900
categories: ["PS"]
tags: ["Union-Find","그리디"]
math: true
toc_sticky: true
---

[BOJ 호반우가 지각한 이유4](https://www.acmicpc.net/problem/30471)

## 풀이
초기 k개의 킹슬라임 그룹을 합쳐 만들어진 미니 슬라임의 최대 개수 $f(k)$ 는 다음과 같다.
$$f(1)=0, f(k)=max(f(k-a)+f(a))+k-1$$

이 때, $a=1$ 이다. 그 이유는 다음과 같다.

>$k-a$ 개의 킹슬라임을 합친 그룹 $A$ 에 초기 $a$개의 킹슬라임 그룹을 합친다 가정하자.\
>$(k-a>a)$ 만약 초기 $k-a$개의 킹슬라임을 합친 후, $a$ 개를 합친 그룹을 합친다고 가정하면 최종적으로 만들어지는 미니 슬라임의 개수 $g_k=f(k-a)+f(a)+k-1$ 가 된다.\
>이 때, 초기 $a$개의 킹슬라임 중, $a-1$ 개의 킹슬라임을 합치고 남은 킹슬라임은 $k-a$ 개를 합친 그룹에에 합친 후, 다시 합친다면 만들어진 미니 슬라임의 개수 $ g_{k-1}=f(k-a)+k-a+f(a-1)+k-1$ 이 된다.\
>$f(a)-f(a-1) < a$ 이므로 $f(a)-f(a-1) < k-a$ 이다. 따라서 $g_k<g_{k-1}$ 이다.\
>이를 반복하면 초기 $a$개의 킹슬라임 그룹에서 킹슬라임을 1개씩 $k-a$개를 합친 그룹에 합치는 것이 가장 많은 미니 슬라임을 만들게 된다.\
>따라서 $f(k)=f(k-1)+f(1)+k-1=f(k-1)+k-1$ 이 된다.

따라서 $f(k)=f(k-1)+k-1=k(k-1)/2$ 가 된다.

이를 이용해, $M$ 개의 쿼리를 거치며 각 쿼리를 수행 후, 합쳐진 $x$개의 킹슬라임 그룹에 있는 킹슬라임의 개수$\\{a_1,a_2,...,a_x\\}$ 에 대하여 $\sum_{i=1}^{x}f(a_i) + N$ 을 구하면 된다.

이 때, 각 쿼리별로 두 슬라임이 같은 그룹에 있는지 판별하기 위해 Union-Find 구조를 사용한다.

그리고 $x$개의 킹슬라임 그룹에서 다른 두 슬라임 그룹이 합쳐져 $\\{b_1,b_2,...b_{x-1}\\}$ 이 되었다면 해당 쿼리까지 이용해 $x-1$개의 킹슬라임 그룹을 만든 것이다.

따라서 합쳐 지기 전에 구했던 미니 슬라임의 최대 개수에서 기존의 두 슬라임 그룹의 개수에 대한 함수 $f$ 의 값들을 빼고 새로 만들어진 킹슬라임 그룹의 킹슬라임 개수에 대한 함수 $f$ 의 값 더하면 된다.

이 또한 Union-Find 구조를 이용하면 구할 수 있다.

최종적으로 $M$ 개의 쿼리에 대하여 각 연산을 수행하는데 $O(1)$ 의 시간 복잡도를 지니며 초기 $N$개의 슬라임 집합을 만드는데 $O(N)$ 의 시간 복잡도을 가지므로 총 $O(N+M)$ 의 시간 복잡도를 지닌다.

## 추가?